<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Concentra — HR New Hire Form</title>

  <!-- Proper Google Fonts links (no visible text on page) -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet" />

  <style>
    :root{
      --bg:#f6f7fb;
      --card:#ffffff;
      --ink:#101828;
      --muted:#667085;
      --accent:#ff6a21;       /* orange */
      --ink-2:#0f172a;        /* title ink */
      --line:#e7eaf3;
      --radius:18px;
      --shadow: 0 12px 36px rgba(16,24,40,.10);
      --focus: 0 0 0 3px rgba(255,106,33,.28);
    }

    *{box-sizing:border-box}
    html, body{height:100%}
    body{
      margin:0;
      background: var(--bg);
      color: var(--ink);
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;

      /* Prevent top cut-off & respect device notches */
      padding-top: max(28px, env(safe-area-inset-top));
      padding-left: max(20px, env(safe-area-inset-left));
      padding-right: max(20px, env(safe-area-inset-right));
      padding-bottom: max(28px, env(safe-area-inset-bottom));
    }

    /* ——— LAYOUT ——— */
    .hero{
      position:relative;
      width:100%;
      max-width:1200px;
      margin: 0 auto;
      border-radius: calc(var(--radius) + 6px);
      overflow:hidden;
      background: linear-gradient(180deg, #ffffff, #fbfcff);
      box-shadow: var(--shadow);
    }
    .bg-architecture{
      position:absolute; inset:0;
      background:
        url('data:image/svg+xml;utf8,\
        <svg xmlns="http://www.w3.org/2000/svg" viewBox=\'0 0 1200 600\' preserveAspectRatio=\'none\'>\
          <g fill=\'none\' stroke=\'%23cfd6e6\' stroke-width=\'1.2\' opacity=\'0.35\'>\
            <path d=\'M60 520 L260 160 L520 240 L720 80 L980 160\'/>\
            <path d=\'M80 540 L280 180 L540 260 L740 100 L1000 180\'/>\
            <path d=\'M100 560 L300 200 L560 280 L760 120 L1020 200\'/>\
            <path d=\'M0 360 L240 280 L480 340 L760 300 L1100 360\'/>\
            <rect x=\'820\' y=\'60\' width=\'260\' height=\'180\' rx=\'4\'/>\
            <rect x=\'480\' y=\'220\' width=\'180\' height=\'110\' rx=\'4\'/>\
            <line x1=\'980\' y1=\'60\' x2=\'980\' y2=\'240\'/>\
            <line x1=\'480\' y1=\'220\' x2=\'660\' y2=\'330\'/>\
          </g>\
        </svg>') center/cover no-repeat;
      pointer-events:none;
      mix-blend-mode:multiply;
    }
    .wave{
      position:absolute; left:-5%; right:-5%; bottom:-1px; height:200px;
      background:
        radial-gradient(65% 120% at 20% 70%, rgba(255,106,33,.25), transparent 60%),
        radial-gradient(60% 120% at 80% 30%, rgba(255,106,33,.2), transparent 60%),
        linear-gradient(180deg, rgba(255,106,33,.95), rgba(255,106,33,.85));
      clip-path: path("M0,120 C180,60 320,160 520,110 C720,60 880,150 1200,90 L1200,200 L0,200 Z");
      opacity:.95;
    }

    .content{
      position:relative;
      display:grid;
      grid-template-columns: 1.05fr 1fr;
      min-height: 720px;
    }
    @media (max-width:980px){ .content{ grid-template-columns:1fr } }

    /* LEFT panel */
    .info{
      padding: 44px 46px 220px;
      display:flex; flex-direction:column; gap:24px;
    }
    .brand{
      display:flex; align-items:center; gap:14px; font-weight:800; color:var(--ink-2)
    }
    .brand img{
      height:40px; width:auto; display:block;
    }
    .headline{ font-size: clamp(22px, 3vw, 30px); margin:6px 0 4px; }
    .sub{ color:var(--muted); max-width:60ch }

    .card{ background:#fff; border:1px solid var(--line); border-radius:14px; padding:18px; display:grid; gap:14px; max-width:580px; }
    .row{ display:flex; gap:12px; align-items:flex-start; line-height:1.5; color:var(--ink); }
    .icon{ width:18px; height:18px; color:var(--accent); flex:0 0 auto; margin-top:2px; }
    .row strong{ display:block; font-weight:700 }
    .row span{ color:var(--muted) }

    /* RIGHT / Wizard shell */
    .formWrap{
      position:relative; background: linear-gradient(0deg, rgba(255,255,255,.88), rgba(255,255,255,.88));
      border-left:1px solid var(--line);
      display:flex; align-items:center; justify-content:center;
      padding:48px 44px;
    }

    .wizard{
      width:100%; max-width:720px;
      background:#fff; border:1px solid var(--line); border-radius: var(--radius);
      box-shadow:0 12px 28px rgba(16,24,40,.08); overflow:hidden;
    }

    .wizard-header{ padding:16px 24px; border-bottom:1px solid var(--line); background:#fff }
    .steps{ display:flex; gap:16px; align-items:center; justify-content:space-between; flex-wrap:wrap }
    .step{ display:flex; align-items:center; gap:12px; min-width:0; flex:1 }
    .step .dot{
      width:34px; height:34px; border-radius:999px; border:2px solid #e5e7eb; display:grid; place-items:center; font-weight:800; font-size:12px; color:#6b7280;
    }
    .step.active .dot{ border-color: var(--accent); background: var(--accent); color:#fff }
    .step.done .dot{ border-color:#16a34a; background:#16a34a; color:#fff }
    .step .label{ color:#475467; font-size:13px; font-weight:800; white-space:nowrap; overflow:hidden; text-overflow:ellipsis }

    /* FORM & PANELS */
    form{ padding:24px 24px 8px }
    .panel{ min-height: 420px; display:block }
    .panel[hidden]{ display:none !important; }   /* keep hidden steps hidden */

    .grid{ display:grid; grid-template-columns: 1fr 1fr; gap:18px 18px }
    .col-1{ grid-column: span 1 }
    .col-2{ grid-column: span 2 }
    @media (max-width:780px){ .grid{ grid-template-columns:1fr } .col-2{ grid-column:1 } }

    .control{ position:relative }
    .control input, .control select, .control textarea{
      width:100%; border:1px solid var(--line); border-radius:14px;
      padding:18px 16px; font-size:16px; outline:none; background:#fff; color:#101828;
      transition:border-color .15s ease, box-shadow .15s ease;
    }
    .control textarea{ min-height:140px; resize:vertical }
    .control input::placeholder, .control textarea::placeholder{ color:#98a2b3; opacity:.9 }
    .control input:focus, .control select:focus, .control textarea:focus{ border-color:#ff8a4a; box-shadow: var(--focus) }
    .control label{
      position:relative; display:inline-block; margin: 0 0 10px 4px; font-size:13px; color:#344054; font-weight:800;
    }

    .chips{ display:flex; flex-wrap:wrap; gap:14px }
    .chip{ display:inline-flex; align-items:center; gap:10px; padding:12px 14px; border:1px solid var(--line); border-radius:14px; background:#fff; color:#111 }
    .chip input{ accent-color: var(--accent) }

    .note{ font-size:12px; color:#9aa4b2; margin-top:6px }
    .lock{ font-size:12px; color:#dc6803; font-weight:800; margin-left:6px }

    .box{ border:1px dashed var(--line); border-radius:14px; padding:16px }
    .box h4{ margin:0 0 12px; font-size:15px; color:#344054 }
    .list{ display:grid; gap:12px }
    .check{ display:flex; align-items:flex-start; gap:12px }
    .check input{ margin-top:3px; accent-color: var(--accent) }
    .check label{ color:#111; line-height:1.35 }
    .price{ color:#667085; font-weight:700; margin-left:6px }

    .totals{ display:flex; justify-content:flex-end; font-weight:900; color:#111; margin-top:12px }

    /* ACTION BAR */
    .actions{
      position:sticky; bottom:0; z-index:2;
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding:14px 24px 20px; background:linear-gradient(180deg, rgba(255,255,255,0), #fff 40%);
      border-top: 1px solid var(--line);
    }
    .btn{ appearance:none; border:none; outline:none; cursor:pointer; border-radius:999px; font-weight:900; letter-spacing:.3px; padding:14px 20px; font-size:15px; transition: transform .06s ease, box-shadow .15s ease }
    .btn.secondary{ background:#fff; color:#111827; border:1px solid var(--line) }
    .btn.primary{ background:var(--accent); color:#fff; box-shadow:0 8px 16px rgba(255,106,33,.25) }
    .btn.primary:hover{ transform:translateY(-1px) }
    .btn.primary.is-loading{ position:relative; pointer-events:none; opacity:.85 }
    .btn.primary.is-loading::after{
      content:""; position:absolute; right:12px; top:50%; transform:translateY(-50%);
      width:16px; height:16px; border-radius:50%; border:2px solid rgba(255,255,255,.6); border-top-color:#fff; animation:spin .8s linear infinite;
    }
    @keyframes spin{to{transform:translateY(-50%) rotate(360deg)}}

    .status{ min-height:22px; font-size:13px; color:#667085 }
    .status.error{ color:#dc2626 }
    .status.success{ color:#16a34a }

    .sr-only{ position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0 }
    .honeypot{ position:absolute; left:-9999px; width:1px; height:1px; opacity:0 }
  </style>
</head>
<body>
  <div class="hero">
    <div class="bg-architecture" aria-hidden="true"></div>
    <div class="wave" aria-hidden="true"></div>

    <div class="content">
      <!-- LEFT panel -->
      <section class="info">
        <div class="brand" aria-label="Concentra">
          <img src="./concentra-logo.png" alt="Concentra" />
          <span>HR New Hire</span>
        </div>

        <h2 class="headline">Step through the essentials—one section at a time.</h2>
        <p class="sub">
          This is Concentra’s HR New Hire Form. It will walk you through the steps to start the process of hiring a new colleague.
          Complete each section and submit to automatically route details to HR/IT via email.
        </p>

        <div class="card">
          <div class="row">
            <!-- phone icon -->
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
              <path d="M22 16.9v2a2 2 0 0 1-2.2 2c-3.1-.3-6.1-1.6-8.5-4s-3.7-5.4-4-8.5A2 2 0 0 1 9.4 6h2a2 2 0 0 1 2 1.7c.1.9.4 1.7.8 2.5a2 2 0 0 1-.5 2.2l-.7.7a16 16 0 0 0 6 6l.7-.7a2 2 0 0 1 2.2-.5c.8.4 1.6.6 2.5.8A2 2 0 0 1 22 16.9z" stroke-width="1.4"/>
            </svg>
            <div>
              <strong>Support</strong>
              <span>940‑217‑8680</span>
            </div>
          </div>

          <div class="row">
            <!-- location pin -->
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
              <path d="M12 22s7-5.2 7-12a7 7 0 1 0-14 0c0 6.8 7 12 7 12z" stroke-width="1.6"/>
              <circle cx="12" cy="10" r="2.8" stroke-width="1.6"/>
            </svg>
            <div>
              <strong>Primary Location</strong>
              <span>Addison, TX</span>
            </div>
          </div>

          <div class="row">
            <!-- clock -->
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
              <circle cx="12" cy="12" r="9" stroke-width="1.6"/>
              <path d="M12 7v6l4 2" stroke-width="1.6" stroke-linecap="round"/>
            </svg>
            <div>
              <strong>Business Hours</strong>
              <span>Mon–Fri • 8:00 AM – 5:00 PM CST</span>
            </div>
          </div>
        </div>
      </section>

      <!-- RIGHT panel: Wizard -->
      <section class="formWrap">
        <div class="wizard" id="wizard">
          <!-- Progress -->
          <div class="wizard-header">
            <div class="steps" id="stepper">
              <div class="step active"><div class="dot">1</div><div class="label">Contact</div></div>
              <div class="step"><div class="dot">2</div><div class="label">Role &amp; Software</div></div>
              <div class="step"><div class="dot">3</div><div class="label">Equipment</div></div>
              <div class="step"><div class="dot">4</div><div class="label">Notes &amp; Submit</div></div>
            </div>
          </div>

          <form id="newHireForm" novalidate>
            <input class="honeypot" type="text" name="website" tabindex="-1" autocomplete="off" />

            <!-- STEP 1: Contact -->
            <div class="panel" data-step="1">
              <div class="grid">
                <div class="control col-1">
                  <label for="fullName">Full Name *</label>
                  <input required id="fullName" name="fullName" placeholder="Jane Doe" />
                </div>
                <div class="control col-1">
                  <label for="personalEmail">Personal Email *</label>
                  <input required id="personalEmail" name="personalEmail" type="email" placeholder="name@example.com" />
                </div>

                <div class="control col-1">
                  <label for="startDate">Start Date *</label>
                  <input required id="startDate" name="startDate" type="date" />
                </div>
                <div class="control col-1">
                  <label for="jobTitle">Job Title *</label>
                  <input required id="jobTitle" name="jobTitle" placeholder="e.g., Medical Assistant" />
                </div>

                <div class="control col-1">
                  <label for="department">Department</label>
                  <input id="department" name="department" placeholder="e.g., Front Office" />
                </div>
                <div class="control col-1">
                  <label for="manager">Manager</label>
                  <input id="manager" name="manager" placeholder="e.g., Kendall, Danielle" />
                </div>

                <div class="control col-2">
                  <label for="office">Office Location *</label>
                  <select id="office" name="office" required>
                    <option value="" disabled selected hidden>Select a location</option>
                    <option>Addison, TX</option>
                    <option>Remote</option>
                  </select>
                </div>
              </div>
            </div>

            <!-- STEP 2: Role & Software -->
            <div class="panel" data-step="2" hidden>
              <div class="grid">
                <div class="control col-2">
                  <label>Is this person a Manager? *</label>
                  <div class="chips" role="group" aria-label="Manager">
                    <label class="chip"><input type="radio" name="isManager" value="Yes" required /> Yes</label>
                    <label class="chip"><input type="radio" name="isManager" value="No" required /> No</label>
                  </div>
                  <div class="note">Managers automatically receive <strong>Adobe Pro</strong> and <strong>Zoom (Paid)</strong>.</div>
                </div>

                <div class="col-2 box">
                  <h4>Software Needed</h4>
                  <div class="list">
                    <div class="check"><input type="checkbox" id="swAdobeFree" name="software" value="Adobe (Free)" /><label for="swAdobeFree">Adobe (Free)</label></div>
                    <div class="check"><input type="checkbox" id="swAdobePro"  name="software" value="Adobe (Pro)" /><label for="swAdobePro">Adobe (Pro) <span class="lock" id="lockAdobe" hidden>• added for Managers</span></label></div>
                    <div class="check"><input type="checkbox" id="swZoomBasic"  name="software" value="Zoom (Basic)" /><label for="swZoomBasic">Zoom (Basic)</label></div>
                    <div class="check"><input type="checkbox" id="swZoomPaid"   name="software" value="Zoom (Paid)" /><label for="swZoomPaid">Zoom (Paid) <span class="lock" id="lockZoom" hidden>• added for Managers</span></label></div>
                    <div class="check"><input type="checkbox" id="swICIMS"      name="software" value="ICIMS" /><label for="swICIMS">ICIMS</label></div>
                    <div class="check"><input type="checkbox" id="swMarkView"   name="software" value="MarkView" /><label for="swMarkView">MarkView</label></div>
                    <div class="check"><input type="checkbox" id="swDocuSign"   name="software" value="DocuSign" /><label for="swDocuSign">DocuSign</label></div>
                    <div class="check"><input type="checkbox" id="swOther"      name="software" value="Other" /><label for="swOther">Other</label></div>
                    <div class="control col-2" id="otherSoftwareWrap" hidden>
                      <label for="otherSoftware">If “Other”, specify</label>
                      <input id="otherSoftware" name="otherSoftware" placeholder="List the software and any details" />
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- STEP 3: Equipment -->
            <div class="panel" data-step="3" hidden>
              <div class="grid">
                <div class="control col-2">
                  <label>Does this role require advanced technical configuration? *</label>
                  <div class="chips" role="group" aria-label="Advanced config">
                    <label class="chip"><input type="radio" name="advancedConfig" value="Yes" required /> Yes</label>
                    <label class="chip"><input type="radio" name="advancedConfig" value="No" required /> No</label>
                  </div>
                  <div class="note">If Yes, the standard laptop/dock will be replaced with a <strong>Dell Pro Max Laptop</strong> and a <strong>WD25 Docking Station</strong>.</div>
                </div>

                <div class="col-2">
                  <div class="chips" role="group" aria-label="Equipment">
                    <label class="chip"><input type="checkbox" id="eqStdLaptop" name="equipment" value="Standard Laptop" /> Standard Laptop</label>
                    <label class="chip"><input type="checkbox" id="eqProLaptop" name="equipment" value="Dell Pro Max Laptop" /> Dell Pro Max Laptop</label>
                    <label class="chip"><input type="checkbox" id="eqStdDock" name="equipment" value="Standard Docking Station" /> Standard Docking Station</label>
                    <label class="chip"><input type="checkbox" id="eqWD25Dock" name="equipment" value="WD25 Docking Station" /> WD25 Docking Station</label>
                    <label class="chip"><input type="checkbox" name="equipment" value="Monitor" /> Monitor</label>
                    <label class="chip"><input type="checkbox" name="equipment" value="Phone Ext" /> Phone Ext</label>
                    <label class="chip"><input type="checkbox" name="equipment" value="Software Licenses" /> Software Licenses</label>
                  </div>
                </div>

                <div class="col-2 box">
                  <h4>Available Standard Accessories</h4>
                  <div class="list" id="accessoriesList">
                    <div class="check"><input type="checkbox" id="accSecondMonitor" name="accessories" value="Second Monitor (1)" data-price="140"><label for="accSecondMonitor">Second Monitor (1) <span class="price">[ +$140.00 ]</span></label></div>
                    <div class="check"><input type="checkbox" id="accMonitor" name="accessories" value="Monitor (1)" data-price="140"><label for="accMonitor">Monitor (1) <span class="price">[ +$140.00 ]</span></label></div>
                    <div class="check"><input type="checkbox" id="accWiredKb" name="accessories" value="Wired Keyboard (1)" data-price="17"><label for="accWiredKb">Wired Keyboard (1) <span class="price">[ +$17.00 ]</span></label></div>
                    <div class="check"><input type="checkbox" id="accWiredMouse" name="accessories" value="Wired Mouse (1)" data-price="14"><label for="accWiredMouse">Wired Mouse (1) <span class="price">[ +$14.00 ]</span></label></div>
                    <div class="check"><input type="checkbox" id="accWirelessKb" name="accessories" value="Wireless Keyboard (1)" data-price="27"><label for="accWirelessKb">Wireless Keyboard (1) <span class="price">[ +$27.00 ]</span></label></div>
                    <div class="check"><input type="checkbox" id="accWirelessMouse" name="accessories" value="Wireless Mouse (1)" data-price="15"><label for="accWirelessMouse">Wireless Mouse (1) <span class="price">[ +$15.00 ]</span></label></div>
                    <div class="check"><input type="checkbox" id="accDock" name="accessories" value="Docking Station (1)" data-price="170"><label for="accDock">Docking Station (1) <span class="price">[ +$170.00 ]</span></label></div>
                    <div class="check"><input type="checkbox" id="accBackpack" name="accessories" value="Laptop Backpack (1)" data-price="45"><label for="accBackpack">Laptop Backpack (1) <span class="price">[ +$45.00 ]</span></label></div>
                    <div class="check"><input type="checkbox" id="accCase" name="accessories" value="Laptop Carrying Case (1)" data-price="45"><label for="accCase">Laptop Carrying Case (1) <span class="price">[ +$45.00 ]</span></label></div>
                    <div class="check"><input type="checkbox" id="accMonitorCable" name="accessories" value="Monitor Cable (1)" data-price="16"><label for="accMonitorCable">Monitor Cable (1) <span class="price">[ +$16.00 ]</span></label></div>
                    <div class="check"><input type="checkbox" id="accSurge" name="accessories" value="Surge Protector (1)" data-price="13"><label for="accSurge">Surge Protector (1) <span class="price">[ +$13.00 ]</span></label></div>
                    <div class="check"><input type="checkbox" id="accPatch" name="accessories" value="Patch Cable (1)" data-price="8"><label for="accPatch">Patch Cable (1) <span class="price">[ +$8.00 ]</span></label></div>
                  </div>
                  <div class="totals">Estimated accessories total: <span id="accTotal" style="margin-left:6px">$0.00</span></div>
                </div>
              </div>
            </div>

            <!-- STEP 4: Notes & Submit -->
            <div class="panel" data-step="4" hidden>
              <div class="grid">
                <div class="control col-2">
                  <label for="accessNotes">Systems / Access Notes</label>
                  <textarea id="accessNotes" name="accessNotes" placeholder="Teams, EMR/EHR, Jira/Azure DevOps, permissions, groups…"></textarea>
                </div>
                <div class="control col-2">
                  <label for="notes">Additional Notes</label>
                  <textarea id="notes" name="notes" placeholder="Anything else we should know?"></textarea>
                </div>
                <div class="col-2">
                  <label class="chip" style="cursor:pointer; display:inline-flex; align-items:center; gap:8px;">
                    <input required type="checkbox" id="consent" name="consent" value="Yes" />
                    I confirm the information is accurate and can be used for onboarding.
                  </label>
                </div>
              </div>
              <div class="note">When you click Submit, your selections will be sent automatically to tcrownover@concentra.com.</div>
            </div>

            <!-- ACTIONS -->
            <div class="actions">
              <div id="status" class="status" role="status" aria-live="polite"></div>
              <div style="display:flex;gap:12px">
                <button type="button" class="btn secondary" id="prevBtn">Back</button>
                <button type="button" class="btn primary" id="nextBtn">Next</button>
                <button type="submit" class="btn primary" id="submitBtn" hidden>Submit</button>
              </div>
            </div>
          </form>
        </div>
      </section>
    </div>
  </div>

  <script>
    // ======= CONFIG (Your private API endpoint) =======
    // Replace with your Render Web Service URL after you deploy server.js
    const API_ENDPOINT = 'https://newhireform.onrender.com/api/newhire-email';
    const TO_EMAIL     = 'tcrownover@concentra.com';
    // ================================================

    const wizard = document.getElementById('wizard');
    const panels = Array.from(wizard.querySelectorAll('.panel'));
    const steps  = Array.from(document.getElementById('stepper').children);
    const form = document.getElementById('newHireForm');
    const statusEl = document.getElementById('status');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const submitBtn = document.getElementById('submitBtn');

    let current = 0;

    function updateStepper(){
      steps.forEach((s,i)=>{
        s.classList.remove('active','done');
        if (i < current) s.classList.add('done');
        if (i === current) s.classList.add('active');
      });
    }
    function setDisabledOutsideCurrent(){
      panels.forEach((p, idx)=>{
        const inputs = p.querySelectorAll('input, select, textarea');
        inputs.forEach(el => el.disabled = (idx !== current));
      });
    }
    function showPanel(i){
      panels.forEach((p, idx)=> p.hidden = idx !== i);
      current = i;
      updateStepper();
      prevBtn.disabled = current === 0;
      nextBtn.hidden = current === panels.length - 1;
      submitBtn.hidden = current !== panels.length - 1;
      statusEl.textContent = '';
      statusEl.className = 'status';
      setDisabledOutsideCurrent();
      panels[current].scrollIntoView({behavior:'smooth', block:'start'});
    }
    function stepValid(){
      const inputs = panels[current].querySelectorAll('input, select, textarea');
      for (const el of inputs){
        if (el.disabled) continue;
        if (el.type === 'radio'){
          const group = panels[current].querySelectorAll(`input[type="radio"][name="${el.name}"]`);
          if ([...group].some(r=>r.required) && ![...group].some(r=>r.checked)) return false;
        } else if (el.required && !el.value){ return false; }
        if (el.id === 'otherSoftware' && !document.getElementById('swOther').checked){
          el.removeAttribute('required');
        }
      }
      return true;
    }
    nextBtn.addEventListener('click', ()=>{
      if (!stepValid()){
        statusEl.textContent = 'Please complete required fields on this step.';
        statusEl.classList.add('error');
        return;
      }
      if (current < panels.length - 1) showPanel(current + 1);
    });
    prevBtn.addEventListener('click', ()=>{ if (current > 0) showPanel(current - 1); });

    // Manager rule
    const swAdobePro = document.getElementById('swAdobePro');
    const swZoomPaid = document.getElementById('swZoomPaid');
    const lockAdobe  = document.getElementById('lockAdobe');
    const lockZoom   = document.getElementById('lockZoom');
    function applyManagerRule(){
      const v = (form.querySelector('input[name="isManager"]:checked')||{}).value;
      if (v === 'Yes'){
        swAdobePro.checked = true; swAdobePro.disabled = true; lockAdobe.hidden = false;
        swZoomPaid.checked = true; swZoomPaid.disabled = true; lockZoom.hidden = false;
      }else{
        swAdobePro.disabled = false; lockAdobe.hidden = true;
        swZoomPaid.disabled = false; lockZoom.hidden = true;
      }
    }
    form.querySelectorAll('input[name="isManager"]').forEach(r => r.addEventListener('change', applyManagerRule));

    // “Other” detail
    const swOther    = document.getElementById('swOther');
    const otherWrap  = document.getElementById('otherSoftwareWrap');
    const otherInput = document.getElementById('otherSoftware');
    function toggleOther(){
      otherWrap.hidden = !swOther.checked;
      otherInput.required = swOther.checked;
      if (!swOther.checked) otherInput.value = '';
    }
    swOther.addEventListener('change', toggleOther);

    // Advanced config rule
    const eqStdLaptop = document.getElementById('eqStdLaptop');
    const eqProLaptop = document.getElementById('eqProLaptop');
    const eqStdDock   = document.getElementById('eqStdDock');
    const eqWD25Dock  = document.getElementById('eqWD25Dock');
    function applyAdvancedRule(){
      const v = (form.querySelector('input[name="advancedConfig"]:checked')||{}).value;
      if (v === 'Yes'){
        eqProLaptop.checked = true; eqProLaptop.disabled = true;
        eqWD25Dock.checked  = true; eqWD25Dock.disabled  = true;
        eqStdLaptop.checked = false; eqStdLaptop.disabled = true;
        eqStdDock.checked   = false; eqStdDock.disabled   = true;
      }else if (v === 'No'){
        eqStdLaptop.disabled = false;
        eqStdDock.disabled   = false;
        eqProLaptop.disabled = false; eqProLaptop.checked = false;
        eqWD25Dock.disabled  = false; eqWD25Dock.checked  = false;
      }
    }
    form.querySelectorAll('input[name="advancedConfig"]').forEach(r => r.addEventListener('change', applyAdvancedRule));

    // Accessories total
    const accList = document.getElementById('accessoriesList');
    const accTotal = document.getElementById('accTotal');
    function fmt(n){ return n.toLocaleString(undefined,{style:'currency',currency:'USD'}); }
    function calcTotal(){
      let sum = 0;
      accList.querySelectorAll('input[type="checkbox"]').forEach(b => { if (b.checked) sum += Number(b.dataset.price||0); });
      accTotal.textContent = fmt(sum);
      return sum;
    }
    accList.addEventListener('change', calcTotal);

    // Init
    showPanel(0);
    calcTotal();

    // Email builder (Outlook-safe table)
    const htmlEscape = s => String(s || '').replace(/[<>&]/g, c=>({'<':'&lt;','>':'&gt;','&':'&amp;'}[c]));
    function row(label, value){
      return '<tr>'+
        '<td style="background:#f6f8ff;border:1px solid #e6e9f5;padding:10px 12px;font-weight:800;width:280px;">'+ htmlEscape(label) +'</td>'+
        '<td style="border:1px solid #e6e9f5;padding:10px 12px;">'+ htmlEscape(value) +'</td>'+
      '</tr>';
    }
    function buildEmail(fd){
      const software = fd.getAll('software');
      const equipment = fd.getAll('equipment');
      const accessories = fd.getAll('accessories');
      const accessoriesTotal = Number(fd.get('accessoriesTotal') || 0);

      const lines = [];
      lines.push(row('Full Name', fd.get('fullName') || ''));
      lines.push(row('Personal Email', fd.get('personalEmail') || ''));
      lines.push(row('Start Date', fd.get('startDate') || ''));
      lines.push(row('Job Title', fd.get('jobTitle') || ''));
      lines.push(row('Department', fd.get('department') || ''));
      lines.push(row('Manager', fd.get('manager') || ''));
      lines.push(row('Office Location', fd.get('office') || ''));

      lines.push(row('Is Manager', fd.get('isManager') || 'No'));
      lines.push(row('Software', software.length ? software.join(', ') : '(none)'));
      if (software.includes('Other') && (fd.get('otherSoftware')||'').trim()){
        lines.push(row('Other Software', fd.get('otherSoftware')));
      }

      lines.push(row('Advanced Technical Configuration', fd.get('advancedConfig') || 'No'));
      lines.push(row('Equipment', equipment.length ? equipment.join(', ') : '(none)'));

      lines.push(row('Accessories', accessories.length ? accessories.join(', ') : '(none)'));
      lines.push(row('Accessories Estimated Total', accessoriesTotal ? ('$' + accessoriesTotal.toFixed(2)) : '$0.00'));

      const title = 'New Hire — ' + htmlEscape(fd.get('fullName') || 'Submission');
      return ''+
      '<div style="font-family:Segoe UI, Arial, sans-serif; color:#111;">'+
        '<h2 style="margin:0 0 12px; font-weight:800;">'+ title +'</h2>'+
        '<p style="margin:0 0 18px; color:#334;">Submitted at <strong>'+ new Date().toLocaleString() +'</strong></p>'+
        '<table role="presentation" cellspacing="0" cellpadding="0" style="border-collapse:collapse;border:1px solid #e6e9f5;width:100%;">'+
          lines.join('')+
        '</table>'+
        '<p style="margin-top:16px; color:#556;">This email was generated by the Concentra HR New Hire form.</p>'+
      '</div>';
    }

    // Submit — POST to your private API (no API keys in browser)
    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      statusEl.textContent = 'Sending…';
      statusEl.className = 'status';
      submitBtn.classList.add('is-loading');

      // Honeypot
      if (form.querySelector('input[name="website"]').value) return;

      // “Other” text required only if Other is checked
      const otherChecked = document.getElementById('swOther').checked;
      document.getElementById('otherSoftware').required = otherChecked;

      // Enable all fields for FormData capture
      panels.forEach(p => p.querySelectorAll('input, select, textarea').forEach(el => el.disabled = false));

      if (!form.checkValidity()){
        statusEl.textContent = 'Please complete the required fields.';
        statusEl.classList.add('error');
        submitBtn.classList.remove('is-loading');
        setDisabledOutsideCurrent();
        return;
      }

      // Accessories total
      let sum = 0;
      document.querySelectorAll('#accessoriesList input[type="checkbox"]').forEach(b => { if (b.checked) sum += Number(b.dataset.price||0); });

      const fd = new FormData(form);
      fd.append('accessoriesTotal', sum.toFixed(2));

      const emailHtml = buildEmail(fd);
      const payload = {
        to: TO_EMAIL,
        subject: 'New Hire — ' + (fd.get('fullName') || 'Submission'),
        html: emailHtml
      };

      try{
        const res = await fetch(API_ENDPOINT, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        if (!res.ok){
          const txt = await res.text().catch(()=> '');
          throw new Error(`API error (${res.status}): ${txt}`);
        }

        statusEl.textContent = 'Submitted! Your email has been sent.';
        statusEl.classList.add('success');

        // Reset wizard
        form.reset();
        toggleOther();
        applyManagerRule();
        applyAdvancedRule();
        calcTotal();
        showPanel(0);
      }catch(err){
        console.error(err);
        statusEl.textContent = 'Send failed: ' + err.message;
        statusEl.classList.add('error');
        setDisabledOutsideCurrent();
      }finally{
        submitBtn.classList.remove('is-loading');
      }
    });
  </script>
</body>
</html>